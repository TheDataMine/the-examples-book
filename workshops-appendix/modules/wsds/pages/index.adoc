= WSDS Notes

This page was prepared for the Women in Statistics and Data Science conference, held November 12–14, 2025. You are welcome to use it to practice working with SQLite.

We will use Jupyter Lab notebook on https://www.rcac.purdue.edu/compute/anvil[Anvil], that is a supercomputer funded by the National Science Foundation. 

== Data Sets: IMDb 

We will use https://developer.imdb.com/non-commercial-datasets/[IMDb] SQLite data located at: `/anvil/projects/tdm/data/movies_and_tv/imdb.db`[1]

The following is an illustration of the database to help you understand the data.

image::figure14.webp[Database diagram from https://dbdiagram.io, width=792, height=500, loading=lazy, title="Database diagram from https://dbdiagram.io"]


[1] There are 7 data files provided by IMDb:

[source,bash]
----
name.basics.tsv.gz
title.akas.tsv.gz
title.basics.tsv.gz
title.crew.tsv.gz
title.episode.tsv.gz
title.principals.tsv.gz
title.ratings.tsv.gz
----

We will use the SQLite database format created from those tsv (Tab-Separated Values) files.

== Structured Query Language (SQL)

Structured Query Language (SQL) is a language used for querying and manipulating data in a database. SQL allows users to efficiently create, read, update, and delete data in databases. It is widely used across applications, from small projects to large-scale industry systems. For data analysts, data scientists, and software developers, understanding SQL is essential for working effectively with databases.

== Basics of Querying

For today's practices, please select the `seminar` kernel. To run SQL queries in a Jupyter Lab notebook, first run the following in a cell at the top of your notebook to establish a connection with the database:

[source, sql]
----
%sql sqlite:////anvil/projects/tdm/data/movies_and_tv/imdb.db
----

[TIP]
====
In sqlite, you can show the tables using the following query:

[source, sql]
----
.tables
----

Unfortunately, sqlite-specific functions can't be run in a Jupyter Lab cell like that. Instead, we need to use a different query as follows:

[source, sql]
----
SELECT tbl_name FROM sqlite_master WHERE type='table';
----
====

Lets see first five lines of `people` table and `titles`:

[source, sql]
----
SELECT * FROM people LIMIT 5;

SELECT * FROM titles LIMIT 5;
----

It is a good idea to run this query on each table in the dataset to identify the common keys that can be used to connect the tables in SQL. It is also helpful to limit the number of rows you display, viewing an entire table at once is not practical. 

[TIP]
====
In SQL and certain other languages like bash or batch, the asterisk (*) acts as a wildcard that represents "everything". For instance, the command SELECT * FROM table retrieves all columns from the table named table, regardless of their names, data types, or values. This feature is convenient when you want to extract every piece of data from a table without listing each column one by one.
====


Now, let’s check how many records are in the people table:

[source, sql]
----
SELECT COUNT(*) FROM people;
----

As you can see, there are more than 11 million records, so displaying the full table would not be feasible.

Let’s take a closer look at the titles table by running the following query:

[source, sql]
----
SELECT * FROM titles LIMIT 5;
----

As you can see, each row includes a `title_id` that corresponds to the title of a movie, TV show, or another type of media. But what exactly is this `title_id`? Take a look at the following link:

https://www.imdb.com/title/tt0111161

At this point, you might guess that this is the ID IMDb uses to identify a movie or TV show. Let’s test that assumption by running a query on our database to find any titles in the `titles` table that match the `title_id` provided in the link above:

[source, sql]
----
SELECT * FROM titles WHERE title_id = 'tt0111161';
----

It is The Shawshank Redemption, the top rated movie in IMDb! 

Let's try this one :)

[source, sql]
----
SELECT * FROM titles WHERE title_id = 'tt0108778';
----

You can even find some episodes, when you go to search in https://imdb.com your favorite one which is "the one where Rose pivots" and we see the episode is this one (The one where Ross moves in):

https://www.imdb.com/title/tt0583486

image::friends-ross.gif[Database diagram from https://tenor.com/search/ross-pivot-gifs, width=292, height=100, loading=lazy]

Let's check if `title_id` also works for `episodes` table, too:


[source, sql]
----
SELECT * FROM episodes WHERE episodes_title_id = 'tt0108778';
----

No, since it is the title of the show not the title of the episode. Let us change it to `show_title_id`:

[source, sql]
----
SELECT * FROM episodes WHERE show_title_id = 'tt0108778';
----

Of course, if you try `show_title_id` for `tt0111161`, you will not get any result, since it is a movie instead of a show. 

Let's see who was staring in Friends:

[source, sql]
----
SELECT * FROM crew WHERE show_title_id = 'tt0108778';
----

We can create a new code cell and write a SQL query to select all columns from the `titles` table where the `original_title` is 'Friends' and premiered 1994:

[source, sql]
----
SELECT * FROM titles WHERE original_title = 'Friends' AND premiered = '1994';
----

[NOTE]
====
You can use the `AND` operator to combine multiple conditions within a `WHERE` clause. Simply place the operator between each condition you want to evaluate. You can also use other logical operators. For example, `OR` checks if at least one condition is true, and `NOT` is used to reverse a condition.

However, orders matters in here. The order of evaluation (operator precedence) for logical operators is:

`NOT` — evaluated first +
`AND` — evaluated second +
`OR` — evaluated last +

You can test it with the following two commands:

[source, sql]
----
SELECT COUNT(*) FROM titles WHERE original_title = 'Friends' OR premiered = 1994 AND ended = 2004;
----

[source, sql]
----
SELECT COUNT(*) FROM titles WHERE original_title = 'Friends' AND premiered = 1994 OR ended = 2004;
----
====





== Resources 

- You can find more information about SQL commands in the https://www.sqlite.org/lang.html[SQLite documentation].

